{%extends 'base.html'%}
{%load static%}
<link rel="stylesheet" href="{%static 'CSS/main.css'%}">

{% block title %} Category {%endblock%}
<style>



    
    .product-card-wrapper:hover .product-actions {
        transform: translateY(0);
    }

    /* Action Buttons */
    .product-actions .btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border: none;
        background: rgba(126, 5, 100, 0.9);
        color: white;
    }

    .product-actions .btn:hover {
        background: #000;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .product-actions .btn-outline-dark {
        background: transparent;
        border: 1px solid #7e0564;
        color: #7e0564;
    }

    .product-actions .btn-outline-dark:hover {
        background: #7e0564;
        color: white;
    }

    /* Quantity Selector */
    .add-to-cart-form {
        width: 100%;
    }

    .input-group {
        max-width: 130px;
        margin: 0 auto;
        border-radius: 30px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .qty-btn {
        width: 35px;
        background: #f8f9fa;
        border: none;
        transition: all 0.2s ease;
    }

    .qty-btn:hover {
        background: #e9ecef;
    }

    .qty-input {
        border-left: none;
        border-right: none;
        border-top: 1px solid #dee2e6;
        border-bottom: 1px solid #dee2e6;
        text-align: center;
        font-weight: 600;
        color: #333;
    }

    /* Add to Cart Button */
    .btn-primary-custom {
        background: #7e0564;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 30px;
        font-weight: 500;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-size: 0.8rem;
        width: 100%;
        margin-top: 10px;
        box-shadow: 0 4px 15px rgba(126, 5, 100, 0.3);
    }

    .btn-primary-custom:hover {
        background: #5a0345;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(126, 5, 100, 0.4);
    }

    /* Product Info Section */
    .product-info {
        padding: 20px;
    }

    .product-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #333;
    }

    .product-price {
        font-family: 'Montserrat', sans-serif;
        font-size: 1.1rem;
        font-weight: 600;
        color: #7e0564;
        margin-bottom: 1rem;
    }

    .product-description {
        font-family: 'Montserrat', sans-serif;
        font-size: 0.85rem;
        color: #666;
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    /* Responsive Adjustments */
    @media (max-width: 1199.98px) {
        .product-image-container {
            height: 280px;
        }
    }

    @media (max-width: 991.98px) {
        .product-image-container {
            height: 240px;
        }
    }

    @media (max-width: 767.98px) {
        .product-image-container {
            height: 320px;
        }
    }

    @media (max-width: 575.98px) {
        .product-image-container {
            height: 280px;
        }
        
        .product-actions {
            padding: 10px;
        }
        
        .product-actions .btn {
            width: 36px;
            height: 36px;
        }
    }



    /* Product Actions */
    .product-actions {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        padding: 15px;
        transform: translateY(100%);
        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        display: flex;
        justify-content: center;
        gap: 10px;
        backdrop-filter: blur(5px);
        border-top: 1px solid rgba(0, 0, 0, 0.05);
    }

    .product-card-wrapper:hover .product-actions {
        transform: translateY(0);
    }

    /* Action Buttons */
    .product-actions .btn {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border: none;
        background: rgba(126, 5, 100, 0.9);
        color: white;
    }

    .product-actions .btn:hover {
        background: #000;
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .product-actions .btn-outline-dark {
        background: transparent;
        border: 1px solid #7e0564;
        color: #7e0564;
    }

    .product-actions .btn-outline-dark:hover {
        background: #7e0564;
        color: white;
    }

    /* Quantity Selector */
    .add-to-cart-form {
        width: 100%;
    }

    .input-group {
        max-width: 130px;
        margin: 0 auto;
        border-radius: 30px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .qty-btn {
        width: 35px;
        background: #f8f9fa;
        border: none;
        transition: all 0.2s ease;
    }

    .qty-btn:hover {
        background: #e9ecef;
    }

    .qty-input {
        border-left: none;
        border-right: none;
        border-top: 1px solid #dee2e6;
        border-bottom: 1px solid #dee2e6;
        text-align: center;
        font-weight: 600;
        color: #333;
    }

    /* Add to Cart Button */
    .btn-primary-custom {
        background: #7e0564;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 30px;
        font-weight: 500;
        letter-spacing: 0.5px;
        transition: all 0.3s ease;
        text-transform: uppercase;
        font-size: 0.8rem;
        width: 100%;
        margin-top: 10px;
        box-shadow: 0 4px 15px rgba(126, 5, 100, 0.3);
    }

    .btn-primary-custom:hover {
        background: #5a0345;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(126, 5, 100, 0.4);
    }

    /* Product Info Section */
    .product-info {
        padding: 20px;
    }

    .product-title {
        font-family: 'Playfair Display', serif;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: #333;
    }

    .product-price {
        font-family: 'Montserrat', sans-serif;
        font-size: 1.1rem;
        font-weight: 600;
        color: #7e0564;
        margin-bottom: 1rem;
    }

    .product-description {
        font-family: 'Montserrat', sans-serif;
        font-size: 0.85rem;
        color: #666;
        line-height: 1.6;
        margin-bottom: 1.5rem;
    }

    /* Responsive Adjustments */
    @media (max-width: 1199.98px) {
        .product-image-container {
            height: 280px;
        }
    }

    @media (max-width: 991.98px) {
        .product-image-container {
            height: 240px;
        }
    }

    @media (max-width: 767.98px) {
        .product-image-container {
            height: 320px;
        }
    }

    @media (max-width: 575.98px) {
        .product-image-container {
            height: 280px;
        }
        
        .product-actions {
            padding: 10px;
        }
        
        .product-actions .btn {
            width: 36px;
            height: 36px;
        }
    }






</style>

<main>
{% block content %}


<div class="container-fluid d-flex justify-content-center align-items-center mb-5" >
  <form action="{% url 'product_search' %}" method="get" class="d-flex align-items-center" role="search" style="gap: 10px;">
    <input class="form-control rounded-pill" 
           type="search" 
           name="q" 
           placeholder="Search products..." 
           aria-label="Search" 
           required 
           style="width: 300px; padding: 10px 20px; font-size: 16px; border: 1px solid #ccc;">
    
    <button class="btn btn-dark rounded-pill" 
            type="submit" 
            style="padding: 10px 20px; font-size: 16px;">
      Search
    </button>
  </form>
</div>


<div class="container-fluid my-4">
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <form method="get">
        <div class="row g-3 align-items-end">
          <!-- Size -->
          

          <!-- Price Min -->
          <div class="col-md-3 col-sm-6">
            <label for="price_min" class="form-label fw-semibold">Price Min (KES)</label>
            <input type="number" step="0.01" name="price_min" id="price_min" class="form-control" value="{{ price_min }}">
          </div>

          <!-- Price Max -->
          <div class="col-md-3 col-sm-6">
            <label for="price_max" class="form-label fw-semibold">Price Max (KES)</label>
            <input type="number" step="0.01" name="price_max" id="price_max" class="form-control" value="{{ price_max }}">
          </div>

          <!-- Sort By -->
          <div class="col-md-3 col-sm-6">
            <label for="sort" class="form-label fw-semibold">Sort By</label>
            <select name="sort" id="sort" class="form-select">
              <option value="">Default</option>
              <option value="price_asc" {% if selected_sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
              <option value="price_desc" {% if selected_sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
              <option value="latest" {% if selected_sort == 'latest' %}selected{% endif %}>Newest First</option>
              <option value="oldest" {% if selected_sort == 'oldest' %}selected{% endif %}>Oldest First</option>
            </select>
          </div>

          <!-- Submit Button -->
          <div class="col-md-3 col-sm-6 d-grid mt-2">
            <button type="submit" class="btn btn-primary fw-semibold">Apply Filters</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>



 <div class="container-fluid px-4 py-5">
          

    
        <div class="row g-4">
        {% for product in products %}
<!-- Updated Product Card Structure -->
<div class="col-xl-3 col-lg-4 col-md-6 mb-4">
    <div class="product-card-wrapper h-100">
        <div class="card h-100 border-0 shadow-sm">
            <!-- Product Image -->
            <div class="position-relative" style="height: 300px; overflow: hidden;">
                <img src="{{ product.image.url }}" class="img-fluid w-100 h-100 object-fit-cover" alt="{{ product.name }}">
                
             <div class="product-badge position-absolute top-0 end-0 m-3 bg-{{ product.get_availability_class }} text-white rounded-pill px-3 py-1 small">
                        {{ product.get_availability_display }}
                    </div>
                <!-- Action Buttons -->
                <div class="product-actions position-absolute bottom-0 start-0 end-0 bg-white p-2 d-flex justify-content-center gap-5"
                     style="opacity: 0; transform: translateY(100%); transition: all 0.3s ease;">
                     

                 <div class="d-flex gap-3 mb-4 align-items-center animate__animated animate__pulse animate__infinite">
   
 
</div>
     
                      <a href="{% url 'product_detail' product.id %}">
                      <button class="  btn-outline-dark btn-lg rounded-pill p-2">
                           View Details
                      </button>
                    </a>               </div>
            </div>


                     <p class="card-text text-muted small mb-3"><b>{{ product.name }}</b></p>
                     <p class="card-text text-muted small mb-3"><b>Ksh.{{ product.price}}</b></p>
                     <p class="card-text text-muted small mb-3">{{ product.description|truncatewords:15 }}</p>
                    
                    
                    <div class="product-meta d-flex flex-wrap">
                        <span class="badge bg-light text-dark me-2 mb-2 rounded-pill">
                            <i class="fas fa-ruler me-1"></i>{{ product.available_sizes }}
                        </span>
                        <span class="badge bg-light text-dark me-2 mb-2 rounded-pill">
                            <i class="fas fa-palette me-1"></i>{{ product.available_colors }}
                        </span>

                        <span class="badge bg-light text-dark me-2 mb-2 rounded-pill">
                            <i class="fas fa-tags me-1"></i>{{ product.category }}
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <div class="empty-state">
                <i class="fas fa-tshirt fa-4x mb-4" style="color: #7e0564;"></i>
                <h3 class="mb-3">Our Collection is Coming Soon</h3>
                <p class="text-muted">We're preparing something special for you!</p>
                <button class="btn btn-outline-dark rounded-pill px-4">Notify Me</button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script src="{% static 'JS/main.js' %}"></script>
<script>
document.querySelectorAll('.add-to-cart').forEach(button => {
    button.addEventListener('click', function (e) {
        e.preventDefault();

        const productId = this.getAttribute('data-product-id');
        const csrftoken = getCookie('csrftoken');

        fetch(`/add-to-cart/${productId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify({
                quantity: 1  // default for homepage
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success && data.cart_count !== undefined) {
                document.getElementById('cart-count').innerText = data.cart_count;
                alert("Added to cart!");
            } else {
                alert("Error: " + (data.error || "Unable to add item."));
            }
        })
        .catch(err => {
            console.error(err);
            alert("Something went wrong while adding to cart.");
        });
    });
});

// CSRF token getter
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (const cookie of cookies) {
            const trimmed = cookie.trim();
            if (trimmed.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(trimmed.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
button.disabled = true;
setTimeout(() => { button.disabled = false }, 1000);

</script>

{%endblock%}
</main>